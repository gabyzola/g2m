<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Student Dashboard ‚Äì MackAdapt</title>
  <link rel="stylesheet" href="style.css" />

  <style>
    :root {
      --bg:#0b1020;
      --panel:#121a33;
      --accent:#6ea8fe;
      --accent-2:#8ef6d4;
      --text:#eef2ff;
      --muted:#a6b0cf;
      --chip:#1c274b;
      --chip-br:#2a3a72;
      --shadow:0 10px 25px rgba(0,0,0,.35);
      --radius:16px;
    }

    body {
      margin:0;
      background:linear-gradient(180deg,#0a0f1e,#0e1630);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
      color:var(--text);
    }

    header {
    background-color: var(--navy);
    color: var(--white);
    padding: 1rem 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  header h1 {
    font-size: 2rem;
    font-weight: bold;
  }

  nav ul {
  list-style: none;
  display: flex;
  gap: 1.5rem;
}

nav a {
  color: var(--gold);
  text-decoration: none;
  font-weight: bold;
  transition: color 0.3s;
}

nav a:hover,
nav a.active {
  color: var(--white);
  border-bottom: 2px solid var(--gold);
}

    .wrap {
      max-width:1180px;
      margin:32px auto;
      padding:0 16px;
    }

    .section-title {
      font-size:22px;
      margin-bottom:12px;
    }

    .card {
      background:linear-gradient(180deg,#111939,#0f1733);
      border:1px solid #1e2b56;
      border-radius:var(--radius);
      box-shadow:var(--shadow);
      padding:18px;
      margin-bottom:20px;
    }

    /* Badge Grid */
    .badge-grid {
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(160px,1fr));
      gap:40px;
    }

    .badge-item {
      text-align:center;
      padding:14px;
      background:#121a33;
      border-radius:var(--radius);
      border:1px solid #1e2b56;
    }

    .badge-item img {
      width:80px;
      height:80px;
      object-fit:contain;
      margin-bottom:8px;
    }

    /* PDF Embed */
    .pdf-frame {
      width:100%;
      height:500px;
      border:1px solid #2a3a72;
      border-radius:var(--radius);
    }

    /* Delete Account */
    .danger-btn {
      background:#FFC72C;;
      border:none;
      padding:12px 18px;
      border-radius:10px;
      /* color:white; */
      cursor:pointer;
      font-size:15px;
      font-weight:600;
    }

    /* Modal */
    .modal-overlay {
      position:fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,.6);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:999;
    }

    .modal {
      background:#121a33;
      border:1px solid #2a3a72;
      border-radius:var(--radius);
      padding:24px;
      width:340px;
      text-align:center;
    }

    .modal button {
      margin-top:14px;
      padding:10px 14px;
      border-radius:6px;
      border:none;
      cursor:pointer;
    }

    .modal .confirm { background:#c03939; color:#fff; }
    .modal .cancel { background:#1c274b; color:#fff; margin-right:8px; }
  </style>
</head>

<body>
  <!-- Header -->
  <header>
    <h1>MackAdapt</h1>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="classes.html">Classes</a></li>
        <li><a href="student-dashboard.html" class="active">Student Dashboard</a></li>
        <li><a href="/login.html">Login</a></li>
      </ul>
    </nav>
  </header>

  <div class="wrap">

    <!--badges Section -->
    <section class="card">
      <div class="section-title">üèÖ Your Badges</div>

      <div class="badge-grid">
      </div>
    </section>

    <!-- added user manual -->
    <section class="card">
      <div class="section-title">üìÑ User Manual</div>
      <iframe class="pdf-frame" src="/user-manual.pdf"></iframe>
    </section>

    <section class="card">
      <div class="section-title">Manage Account</div>
      <p>Need to remove your account? This cannot be undone.</p>
      <button class="danger-btn" onclick="openDeleteModal()">Delete My Account</button>
    </section>

  </div>

  <!-- Modal -->
  <div class="modal-overlay" id="deleteModal">
    <div class="modal">
      <h3>Are you sure?</h3>
      <p>This action is permanent and cannot be undone.</p>
      <button class="cancel" onclick="closeDeleteModal()">Cancel</button>
      <button class="confirm" onclick="mockDeleteAccount()">Delete</button>
    </div>
  </div>

  <script type="module">
    import { 
      removeUser,
      getStudentTotalPoints, 
      lookupUserBySub
    } from "./src/api/backend.js";

    let userId = null;

    function openDeleteModal() {
      document.getElementById('deleteModal').style.display = 'flex';
    }
    function closeDeleteModal() {
      document.getElementById('deleteModal').style.display = 'none';
    }
    function mockDeleteAccount() {
      alert("Account would be deleted.");
      closeDeleteModal();
    }

    //defines all badges and point thresholds
    const badges = [
      { name: "Rookie", img: "/Images/badges/Rookie.png", points: 0, description: "Complete your first quiz" },
      { name: "Steady Learner", img: "/Images/badges/Rookie (1).png", points: 100, description: "Reach 100 total points" },
      { name: "Knowledge Collector", img: "/Images/badges/Rookie (2).png", points: 500, description: "Reach 500 total points" },
      { name: "Quiz Master", img: "/Images/badges/Rookie (3).png", points: 700, description: "Reach 700 total points" },
      { name: "Legend", img: "/Images/badges/Rookie (4).png", points: 1000, description: "Reach 1000 total points" }
    ];

    async function renderBadges(userId) {
      const points = await getStudentTotalPoints(userId);
      const badgeGrid = document.querySelector(".badge-grid");
      badgeGrid.innerHTML = ""; 

      badges.forEach(badge => {
        const earned = points >= badge.points;
        const div = document.createElement("div");
        div.classList.add("badge-item");
        if (!earned) div.style.filter = "grayscale(80%) opacity(0.5)"; //grayed if not eligable

        div.innerHTML = `
          <img src="${badge.img}" alt="${badge.name}" />
          <div>${badge.description}</div>
        `;
        badgeGrid.appendChild(div);
      });
    }

    // Initialize dashboard
    async function initDashboard() {
      const googleToken = sessionStorage.getItem("googleToken");
      if (!googleToken) return;

      const user = await lookupUserBySub(googleToken);
      if (!user) return;

      userId = user.userId; 
      renderBadges(userId);
    }

    initDashboard();
  </script>
</body>
</html>
