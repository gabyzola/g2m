<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Create Quiz – MackAdapt</title>
  <link rel="stylesheet" href="style.css"/>
  <style>
    .panel{background:#fff;padding:1.25rem;border-radius:10px;box-shadow:0 2px 10px rgba(0,40,85,.08);margin:1rem 0}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    label{display:block;margin:.5rem 0 .25rem}
    input,select,textarea{width:100%;padding:.65rem;border:1px solid #ccc;border-radius:6px}
    textarea{min-height:110px}
    .actions{display:flex;gap:.75rem;margin-top:1rem}
    .notice{font-size:.9rem;color:#444;margin-top:.5rem}
  </style>
</head>
<body>
  <header>
  <h1>MackAdapt</h1>
  <nav>
    <ul>
      <li><a href="index.html">Home</a></li>
      <li><a href="classes.html" class="active" aria-current="page">Classes</a></li>
      <li><a href="student-dashboard.html">Student Dashboard</a></li>
      <li><a href="login.html">Login</a></li>
    </ul>
  </nav>
</header>

  <main>
    <h2>Create Quiz</h2>
    <div style="margin:.25rem 0 1rem">
  <strong>Quick Links:</strong>
  <a href="analytics.html">View Analytics</a> ·
  <a href="classes.html">Back to Classes</a>
</div>

    <div class="panel">
      <h3>Link a Reading</h3>

      <label>Select Reading</label>
      <select id="readingSelect">
        <!-- neeed to update my mapping -->
      </select>

      <div class="actions">
        <button id="addReadingBtn">Attach Reading</button>
      </div>

      <p class="notice">Reading will be linked to this quiz using your backend mapping.</p>
    </div>

    <div class="panel">
      <h3>Add Question</h3>
      <label>Question Text</label>
      <textarea placeholder="Enter the question stem..."></textarea>
      <div class="row">
        <div>
          <label>Difficulty</label>
          <select><option>Easy</option><option>Medium</option><option>Hard</option></select>
        </div>
        <div>
          <label>Learning Objective</label>
          <select>
            <option>LO1 – Memory & Recall</option>
            <option>LO2 – Experimental Design</option>
            <option>LO3 – Learning Theories</option>
            <option>LO4 – Statistics Basics</option>
            <option>LO5 – Research Ethics</option>
          </select>
        </div>
      </div>
      <label>Choices</label>
      <textarea placeholder="A) ...&#10;B) ...&#10;C) ...&#10;D) ..."></textarea>
      <label>Correct Answer</label>
      <input placeholder="e.g., B" />
      <div class="actions">
        <button onclick="alert('Question added')">Add Question</button>
        <button onclick="alert('Quiz saved')">Save Quiz</button>
      </div>
      <p class="notice">Demo only: these buttons just show alerts. Backend wiring will save to the DB and validate fields.</p>
    </div>
  </main>

  <footer><p>&copy; 2025 MackAdapt – Built for Merrimack College</p></footer>
  <script>
      const query = new URLSearchParams(window.location.search);
      const quizId = query.get("quizId");
      const classId = query.get("classId"); 

      //get reading from dropdown
      async function loadReadings() {
        try {
          const res = await fetch(`/classes/${classId}/readings`);
          const data = await res.json();

          const select = document.getElementById("readingSelect");
          select.innerHTML = "";

          if (data.length === 0) {
            const op = document.createElement("option");
            op.textContent = "No readings available";
            op.disabled = true;
            op.selected = true;
            select.appendChild(op);
            return;
          }

          data.forEach(reading => {
            const op = document.createElement("option");
            op.value = reading.readingId;
            op.textContent = reading.readingName; 
            select.appendChild(op);
          });

        } catch (err) {
          console.error("Failed to load readings:", err);
        }
      }

      loadReadings();

      //add question
      document.querySelector("#addQuestionBtn")?.addEventListener("click", async () => {

        const payload = {
          questionText: document.querySelector("#questionText").value,
          difficulty: document.querySelector("#difficulty").value,
          choiceA: document.querySelector("#choiceA").value,
          choiceB: document.querySelector("#choiceB").value,
          choiceC: document.querySelector("#choiceC").value,
          choiceD: document.querySelector("#choiceD").value,
          correctAnswer: document.querySelector("#correctAnswer").value,
          objectiveId: parseInt(document.querySelector("#objective").value)
        };

        const res = await fetch(`/quizzes/${quizId}/questions`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          alert("Question added!");
        } else {
          alert("Error adding question.");
        }
      });


      document.getElementById("addReadingBtn").addEventListener("click", async () => {

        const readingId = parseInt(document.getElementById("readingSelect").value);

        const res = await fetch(`/quizzes/${quizId}/readings`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ readingId })
        });

        if (res.ok) {
          alert("Reading linked!");
        } else {
          alert("Error linking reading.");
        }
      });
    </script>

  </body>
</html>