<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login ‚Äì MackAdapt</title>

  <!-- Vite-compatible CSS path -->
  <link rel="stylesheet" href="/style.css" />

  <!-- MSAL.js -->
  <script src="https://alcdn.msauth.net/browser/2.32.2/js/msal-browser.min.js"></script>

  <style>
    :root {
      --navy: #002855;
      --gold: #ffc72c;
      --white: #ffffff;
      --bg: #f5f7fb;
      --ink: #1f2a44;
      --muted: #6a7591;
    }

    body.login {
      background: linear-gradient(180deg, #eef3ff, #f7f9ff);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background-color: var(--navy);
      color: var(--white);
      padding: 1rem 2rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 { font-size: 1.6rem; }
    header nav ul { list-style: none; display: flex; gap: 1.25rem; margin:0; padding:0; }
    header nav a { color: var(--gold); text-decoration: none; font-weight:bold; }
    header nav a.active { color: var(--white); border-bottom: 2px solid var(--gold); }

    footer {
      background: var(--navy);
      color: var(--white);
      text-align: center;
      padding: 1rem;
    }

    .auth-wrap {
      flex: 1;
      display: grid;
      place-items: center;
      padding: 24px 16px;
    }
    .auth-card {
      width: 100%;
      max-width: 440px;
      background: var(--white);
      border-radius: 14px;
      box-shadow: 0 10px 24px rgba(0, 40, 85, 0.12);
      border: 1px solid rgba(0,40,85,0.08);
      padding: 22px 20px;
    }

    .auth-head { text-align: center; margin-bottom: 16px; }
    .auth-head h2 { margin:6px 0 4px; color:var(--ink); font-size:1.6rem; }
    .auth-head p { margin:0; color:var(--muted); font-size:0.95rem; }

    .btn { display:inline-flex; align-items:center; justify-content:center; gap:8px; border-radius:10px; padding:12px 14px; cursor:pointer; font-weight:700; position:relative; }
    .btn-primary { background: var(--navy); color: var(--gold); border:none; }
    .btn-ghost { background:#fff; color: var(--ink); border:1px solid rgba(0,0,0,0.08); width:100%; }

    .field { display:grid; gap:6px; margin:10px 0 12px; }
    .field label { font-size:0.9rem; color:var(--ink); font-weight:600; }
    .field input { border:1px solid #d8deea; border-radius:10px; padding:12px; font-size:1rem; outline:none; }

    .divider { display:grid; grid-template-columns:1fr auto 1fr; align-items:center; gap:10px; color:var(--muted); font-size:0.9rem; margin:14px 0; }
    .divider::before, .divider::after { content:""; height:1px; background:#e3e8f5; display:block; }

    .aux { display:flex; justify-content:space-between; align-items:center; margin:6px 0 2px; font-size:0.9rem; }
    .aux a { color:var(--ink); }
    .subtle { text-align:center; margin-top:10px; color:var(--muted); font-size:0.9rem; }

    .btn.is-loading { pointer-events:none; opacity:0.8; }
    .btn.is-loading::after {
      content:"";
      position:absolute;
      width:18px; height:18px;
      border:2px solid rgba(255,255,255,0.4);
      border-top-color: rgba(255,255,255,1);
      border-radius:50%;
      animation: spin 0.7s linear infinite;
      left:50%; top:50%; transform:translate(-50%,-50%);
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>

<body class="login">
  <header>
    <h1>MackAdapt</h1>
    <nav aria-label="Primary">
      <ul>
        <li><a href="/index.html">Home</a></li>
        <li><a href="/classes.html">Classes</a></li>
        <li><a href="/student-dashboard.html">Student Dashboard</a></li>
        <li><a href="/login.html" class="active">Login</a></li>
      </ul>
    </nav>
  </header>

  <main class="auth-wrap">
    <section class="auth-card" aria-labelledby="authTitle">
      <div class="auth-head">
        <div aria-hidden="true" style="font-size:2rem">üîê</div>
        <h2 id="authTitle">Sign in to MackAdapt</h2>
        <p>Use your Merrimack Microsoft account or demo login.</p>
      </div>

      <button id="ms-login" class="btn btn-primary">
        <span>Sign in with Microsoft</span>
      </button>

      <div class="divider">or</div>

      <form id="demo-login" novalidate>
        <div class="field">
          <label for="email">Email</label>
          <input id="email" type="email" placeholder="you@merrimack.edu" required />
        </div>
        <div class="field">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
        </div>
        <div class="aux">
          <a href="#" aria-disabled="true">Forgot password?</a>
          <button class="btn btn-ghost" type="submit"><span>Continue</span></button>
        </div>
      </form>

      <p class="subtle">Need an account? Contact your instructor.</p>
    </section>
  </main>

  <footer>
    <p>&copy; 2025 MackAdapt ‚Äì Built for Merrimack College</p>
  </footer>

  <script>
    // ---------------------------
    // MSAL Config
    // ---------------------------
    const msalConfig = {
      auth: {
        clientId: "f1eb948d-5297-47ce-a4c4-419d1f699607",
        authority: "https://login.microsoftonline.com/57e1236c-0fa3-4739-9edf-fd0721c8744d/",
        redirectUri: window.location.origin + "/classes.html"
      },
      cache: { cacheLocation: "localStorage", storeAuthStateInCookie: false }
    };

    const msalInstance = new msal.PublicClientApplication(msalConfig);
    const loginRequest = { scopes: ["openid","profile","email","User.Read"] };

    // ---------------------------
    // Microsoft Login Button
    // ---------------------------
    document.getElementById("ms-login").addEventListener("click", async () => {
      try {
        const response = await msalInstance.loginPopup(loginRequest);
        msalInstance.setActiveAccount(response.account);
        window.location.href = "/classes.html";
      } catch (err) {
        console.error("MS login failed:", err);
        alert("Login failed. Check console for details.");
      }
    });

    // ---------------------------
    // Demo login
    // ---------------------------
    document.getElementById("demo-login").addEventListener("submit", async (e) => {
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if (!email || !password) return alert("Enter email and password.");
      await new Promise(res => setTimeout(res, 600));
      window.location.href = "/classes.html";
    });

    // ---------------------------
    // Auto-login check
    // ---------------------------
    window.addEventListener("DOMContentLoaded", () => {
      const accounts = msalInstance.getAllAccounts();
      if (accounts.length) msalInstance.setActiveAccount(accounts[0]);
    });
  </script>
</body>
</html>
